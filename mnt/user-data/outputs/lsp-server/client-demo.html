<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monaco Editor with VB LSP</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background-color: #f5f5f5;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .status {
            color: #666;
            font-size: 14px;
        }
        .status.connected {
            color: #28a745;
        }
        .status.error {
            color: #dc3545;
        }
        #container {
            width: 100%;
            height: 600px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Visual Basic Editor with Language Server</h1>
        <div class="status" id="status">Connecting to language server...</div>
    </div>
    <div id="container"></div>

    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
    
    <script>
        require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs' } });

        require(['vs/editor/editor.main'], function() {
            const statusEl = document.getElementById('status');
            
            // Register Visual Basic language
            monaco.languages.register({ id: 'vb' });

            // Configure language with better syntax highlighting
            monaco.languages.setMonarchTokensProvider('vb', {
                defaultToken: '',
                tokenPostfix: '.vb',
                ignoreCase: true,

                keywords: [
                    'AddHandler', 'AddressOf', 'Alias', 'And', 'AndAlso', 'As', 'Boolean',
                    'ByRef', 'Byte', 'ByVal', 'Call', 'Case', 'Catch', 'CBool', 'CByte',
                    'CChar', 'CDate', 'CDec', 'CDbl', 'Char', 'CInt', 'Class', 'CLng',
                    'CObj', 'Const', 'Continue', 'CSByte', 'CShort', 'CSng', 'CStr',
                    'CType', 'CUInt', 'CULng', 'CUShort', 'Date', 'Decimal', 'Declare',
                    'Default', 'Delegate', 'Dim', 'DirectCast', 'Do', 'Double', 'Each',
                    'Else', 'ElseIf', 'End', 'EndIf', 'Enum', 'Erase', 'Error', 'Event',
                    'Exit', 'False', 'Finally', 'For', 'Friend', 'Function', 'Get',
                    'GetType', 'GetXMLNamespace', 'Global', 'GoSub', 'GoTo', 'Handles',
                    'If', 'Implements', 'Imports', 'In', 'Inherits', 'Integer', 'Interface',
                    'Is', 'IsNot', 'Let', 'Lib', 'Like', 'Long', 'Loop', 'Me', 'Mod',
                    'Module', 'MustInherit', 'MustOverride', 'MyBase', 'MyClass', 'Namespace',
                    'Narrowing', 'New', 'Next', 'Not', 'Nothing', 'NotInheritable',
                    'NotOverridable', 'Object', 'Of', 'On', 'Operator', 'Option', 'Optional',
                    'Or', 'OrElse', 'Overloads', 'Overridable', 'Overrides', 'ParamArray',
                    'Partial', 'Private', 'Property', 'Protected', 'Public', 'RaiseEvent',
                    'ReadOnly', 'ReDim', 'REM', 'RemoveHandler', 'Resume', 'Return', 'SByte',
                    'Select', 'Set', 'Shadows', 'Shared', 'Short', 'Single', 'Static',
                    'Step', 'Stop', 'String', 'Structure', 'Sub', 'SyncLock', 'Then',
                    'Throw', 'To', 'True', 'Try', 'TryCast', 'TypeOf', 'UInteger', 'ULong',
                    'UShort', 'Using', 'Variant', 'Wend', 'When', 'While', 'Widening',
                    'With', 'WithEvents', 'WriteOnly', 'Xor'
                ],

                operators: [
                    '=', '>', '<', '<=', '>=', '<>', '&', '+', '-', '*', '/', '\\', '^'
                ],

                // Define symbols for bracket matching
                brackets: [
                    ['(', ')', 'delimiter.parenthesis'],
                    ['{', '}', 'delimiter.curly'],
                    ['[', ']', 'delimiter.square']
                ],

                tokenizer: {
                    root: [
                        // Comments
                        [/'.*$/, 'comment'],
                        [/REM\s.*$/i, 'comment'],

                        // Strings
                        [/"([^"\\]|\\.)*$/, 'string.invalid'],
                        [/"/, 'string', '@string'],

                        // Numbers
                        [/\d*\.\d+([eE][\-+]?\d+)?/, 'number.float'],
                        [/\d+/, 'number'],

                        // Identifiers and keywords
                        [/[a-zA-Z_]\w*/, {
                            cases: {
                                '@keywords': 'keyword',
                                '@default': 'identifier'
                            }
                        }],

                        // Operators
                        [/[<>]=?/, 'operator'],
                        [/[+\-*\/\\^&]/, 'operator'],

                        // Delimiters
                        [/[()[\]]/, '@brackets'],
                        [/[,.]/, 'delimiter']
                    ],

                    string: [
                        [/[^\\"]+/, 'string'],
                        [/"/, 'string', '@pop']
                    ]
                }
            });

            // Create the editor with sample code
            const editor = monaco.editor.create(document.getElementById('container'), {
                value: `' Visual Basic Calculator Example
Imports System

Public Class Calculator
    ' Add two numbers and return the result
    Public Function Add(x As Integer, y As Integer) As Integer
        Dim result As Integer
        result = x + y
        Return result
    End Function
    
    ' Subtract two numbers
    Public Function Subtract(x As Integer, y As Integer) As Integer
        Return x - y
    End Function
    
    ' Multiply two numbers
    Private Function Multiply(a As Double, b As Double) As Double
        Dim product As Double
        product = a * b
        Return product
    End Function
    
    ' Display a message to the console
    Private Sub ShowMessage(message As String)
        Console.WriteLine(message)
    End Sub
    
    ' Main entry point
    Public Sub Main()
        Dim x As Integer = 10
        Dim y As Integer = 5
        
        Dim sum As Integer = Add(x, y)
        ShowMessage("Sum: " & sum.ToString())
        
        If sum > 10 Then
            ShowMessage("Sum is greater than 10")
        Else
            ShowMessage("Sum is 10 or less")
        End If
    End Sub
End Class`,
                language: 'vb',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: true },
                fontSize: 14,
                lineNumbers: 'on',
                roundedSelection: true,
                scrollBeyondLastLine: false,
                readOnly: false,
                cursorStyle: 'line',
                formatOnPaste: true,
                formatOnType: true
            });

            // Attempt to connect to LSP server via WebSocket
            try {
                const ws = new WebSocket('ws://localhost:3000');
                
                ws.onopen = () => {
                    statusEl.textContent = 'Connected to language server âœ“';
                    statusEl.className = 'status connected';
                    console.log('WebSocket connected to LSP server');
                    
                    // Note: Full LSP integration requires monaco-languageclient
                    // This is a simplified example showing the WebSocket connection
                    // For production use, implement proper LSP message handling
                };
                
                ws.onerror = (error) => {
                    statusEl.textContent = 'Language server not available (using basic highlighting)';
                    statusEl.className = 'status error';
                    console.error('WebSocket error:', error);
                };
                
                ws.onclose = () => {
                    if (statusEl.className === 'status connected') {
                        statusEl.textContent = 'Disconnected from language server';
                        statusEl.className = 'status error';
                    }
                };
                
            } catch (error) {
                statusEl.textContent = 'Language server not available (using basic highlighting)';
                statusEl.className = 'status error';
                console.log('Could not connect to LSP server:', error);
            }

            // Add some helpful keyboard shortcuts info
            console.log('%cKeyboard Shortcuts:', 'font-weight: bold; font-size: 14px');
            console.log('Ctrl/Cmd + Space: Trigger autocomplete');
            console.log('F12: Go to Definition');
            console.log('Shift + F12: Find References');
            console.log('Ctrl/Cmd + /: Toggle comment');
        });
    </script>
</body>
</html>
